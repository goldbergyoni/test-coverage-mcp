{
  "name": "coverage-analyzer",
  "version": "1.0.0",
  "description": "MCP server for analyzing test coverage from LCOV files with minimal token consumption",
  "tools": [
    {
      "name": "coverage_summary",
      "title": "Get Coverage Summary",
      "description": "Analyzes an LCOV coverage file and returns line coverage percentage. Can return overall project coverage or coverage for specific files. Use this before making code changes to establish a baseline or after changes to verify impact. Returns percentage values (0-100) with 1 decimal precision.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "lcovPath": {
            "type": "string",
            "description": "Path to the LCOV coverage file. Can be absolute or relative. If not provided, defaults to './coverage/lcov.info'. Example: './coverage/lcov.info'"
          },
          "filePath": {
            "type": "string",
            "description": "Optional: Get coverage for a specific file. Provide the file path as it appears in the LCOV file. Cannot be used together with filePaths."
          },
          "filePaths": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Optional: Get coverage for multiple specific files. Provide an array of file paths as they appear in the LCOV file. Cannot be used together with filePath."
          }
        },
        "oneOf": [
          {
            "properties": {
              "lcovPath": true
            },
            "additionalProperties": false
          },
          {
            "properties": {
              "lcovPath": true,
              "filePath": true
            },
            "additionalProperties": false
          },
          {
            "properties": {
              "lcovPath": true,
              "filePaths": true
            },
            "additionalProperties": false
          }
        ]
      },
      "outputSchema": {
        "oneOf": [
          {
            "type": "object",
            "properties": {
              "linesCoveragePercentage": {
                "type": "number",
                "description": "Overall project line coverage percentage (0-100)"
              }
            },
            "required": ["linesCoveragePercentage"]
          },
          {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "File path"
              },
              "coverageInfo": {
                "type": "object",
                "properties": {
                  "linesCoveragePercentage": {
                    "type": "number",
                    "description": "File line coverage percentage (0-100)"
                  }
                },
                "required": ["linesCoveragePercentage"]
              }
            },
            "required": ["path", "coverageInfo"]
          },
          {
            "type": "object",
            "properties": {
              "filesCoverageInfo": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "type": "string",
                      "description": "File path"
                    },
                    "coverageInfo": {
                      "type": "object",
                      "properties": {
                        "linesCoveragePercentage": {
                          "type": "number",
                          "description": "File line coverage percentage (0-100)"
                        }
                      },
                      "required": ["linesCoveragePercentage"]
                    }
                  },
                  "required": ["path", "coverageInfo"]
                }
              }
            },
            "required": ["filesCoverageInfo"]
          }
        ]
      }
    },
    {
      "name": "start_coverage_record",
      "title": "Start Coverage Recording",
      "description": "Creates a snapshot of the current coverage state for later comparison. Use this before making code changes to track coverage impact. Returns a recording ID that must be provided to end_coverage_record. Recordings are automatically cleaned up after 1 hour.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "lcovPath": {
            "type": "string",
            "description": "Path to the LCOV coverage file to snapshot. Can be absolute or relative. If not provided, defaults to './coverage/lcov.info'."
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "recordingId": {
            "type": "string",
            "description": "Unique identifier for this recording session (UUID v4 format)"
          },
          "timestamp": {
            "type": "number",
            "description": "Unix timestamp in milliseconds when recording was started"
          },
          "baselineCoverage": {
            "type": "object",
            "properties": {
              "linesCoveragePercentage": {
                "type": "number",
                "description": "Overall coverage percentage at recording start"
              }
            },
            "required": ["linesCoveragePercentage"]
          }
        },
        "required": ["recordingId", "timestamp", "baselineCoverage"]
      }
    },
    {
      "name": "end_coverage_record",
      "title": "End Coverage Recording and Compare",
      "description": "Compares current coverage against a previously created recording and returns the difference. Shows overall coverage change and per-file changes. Use this after making code changes to measure coverage impact. Automatically cleans up the recording after comparison.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "recordingId": {
            "type": "string",
            "description": "The recording ID returned from start_coverage_record"
          },
          "lcovPath": {
            "type": "string",
            "description": "Path to the current LCOV coverage file to compare against the recording. Can be absolute or relative. If not provided, defaults to './coverage/lcov.info'."
          }
        },
        "required": ["recordingId"]
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "before": {
            "type": "object",
            "properties": {
              "linesCoveragePercentage": {
                "type": "number",
                "description": "Coverage percentage when recording started"
              }
            },
            "required": ["linesCoveragePercentage"]
          },
          "after": {
            "type": "object",
            "properties": {
              "linesCoveragePercentage": {
                "type": "number",
                "description": "Current coverage percentage"
              }
            },
            "required": ["linesCoveragePercentage"]
          },
          "changeInPercentage": {
            "type": "number",
            "description": "Percentage point change in coverage (can be negative). For example, if coverage went from 80% to 85%, this would be 5."
          },
          "fileChanges": {
            "type": "array",
            "description": "Per-file coverage changes, sorted by largest change first",
            "items": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "string",
                  "description": "File path"
                },
                "beforePercentage": {
                  "type": "number",
                  "description": "Coverage percentage when recording started"
                },
                "afterPercentage": {
                  "type": "number",
                  "description": "Current coverage percentage"
                },
                "changePercentage": {
                  "type": "number",
                  "description": "Percentage point change (can be negative)"
                }
              },
              "required": ["path", "beforePercentage", "afterPercentage", "changePercentage"]
            }
          },
          "newFiles": {
            "type": "array",
            "description": "Files that were added to coverage since recording started",
            "items": {
              "type": "string"
            }
          },
          "removedFiles": {
            "type": "array",
            "description": "Files that were removed from coverage since recording started",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["before", "after", "changeInPercentage"]
      }
    }
  ],
  "errorCodes": {
    "LCOV_FILE_NOT_FOUND": {
      "description": "The specified LCOV file could not be found",
      "httpEquivalent": 404
    },
    "LCOV_PARSE_ERROR": {
      "description": "The LCOV file could not be parsed due to invalid format",
      "httpEquivalent": 422
    },
    "FILE_NOT_IN_COVERAGE": {
      "description": "The requested file is not present in the coverage report",
      "httpEquivalent": 404
    },
    "RECORDING_NOT_FOUND": {
      "description": "The specified recording ID does not exist or has expired",
      "httpEquivalent": 404
    },
    "INVALID_RECORDING_ID": {
      "description": "The recording ID is not in valid UUID format",
      "httpEquivalent": 400
    },
    "PATH_RESOLUTION_ERROR": {
      "description": "The file path could not be resolved",
      "httpEquivalent": 400
    }
  }
}